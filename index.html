<!doctype html>
<html lang="en" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pig Crossing</title>
  <script src="https://cdn.tailwindcss.com/3.4.17"></script>
  <script src="/_sdk/element_sdk.js"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600;700&display=swap');
    
    * {
      font-family: 'Fredoka', sans-serif;
    }
    
    .game-container {
      background: linear-gradient(180deg, #87CEEB 0%, #98D8C8 100%);
    }
    
    .road-lane {
      background: repeating-linear-gradient(
        90deg,
        #3d3d3d 0px,
        #3d3d3d 60px,
        #4a4a4a 60px,
        #4a4a4a 120px
      );
    }
    
    .road-marking {
      background: repeating-linear-gradient(
        90deg,
        transparent 0px,
        transparent 30px,
        #f7dc6f 30px,
        #f7dc6f 60px,
        transparent 60px,
        transparent 90px
      );
    }
    
    .safe-zone {
      background: linear-gradient(180deg, #7dcea0 0%, #58d68d 100%);
    }
    
    .start-zone {
      background: linear-gradient(180deg, #f9e79f 0%, #f7dc6f 100%);
    }
    
    .pig {
      transition: left 0.1s ease-out, top 0.1s ease-out;
      filter: drop-shadow(2px 2px 3px rgba(0,0,0,0.3));
    }
    
    .frying-pan {
      animation: wobble 0.3s ease-in-out infinite alternate;
    }
    
    @keyframes wobble {
      0% { transform: rotate(-5deg); }
      100% { transform: rotate(5deg); }
    }
    
    @keyframes bounce {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.1); }
    }
    
    .bounce {
      animation: bounce 0.5s ease-in-out infinite;
    }
    
    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      25% { transform: translateX(-5px); }
      75% { transform: translateX(5px); }
    }
    
    .shake {
      animation: shake 0.3s ease-in-out;
    }
    
    .control-btn {
      background: linear-gradient(180deg, #e74c3c 0%, #c0392b 100%);
      box-shadow: 0 4px 0 #922b21, 0 6px 10px rgba(0,0,0,0.3);
      transition: all 0.1s ease;
    }
    
    .control-btn:active {
      transform: translateY(2px);
      box-shadow: 0 2px 0 #922b21, 0 3px 5px rgba(0,0,0,0.3);
    }
  </style>
  <style>body { box-sizing: border-box; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
 </head>
 <body class="h-full m-0 p-0 overflow-auto">
  <div id="app-wrapper" class="w-full h-full flex flex-col items-center justify-center p-4 game-container"><!-- Header -->
   <div class="text-center mb-4">
    <h1 id="game-title" class="text-3xl md:text-4xl font-bold text-pink-600 drop-shadow-lg">üê∑ Pig Crossing üç≥</h1>
    <div class="flex gap-6 justify-center mt-2 text-lg"><span class="bg-white/80 px-3 py-1 rounded-full font-semibold text-gray-700">Score: <span id="score">0</span></span> <span class="bg-white/80 px-3 py-1 rounded-full font-semibold text-gray-700">Lives: <span id="lives">3</span> ‚ù§Ô∏è</span> <span class="bg-white/80 px-3 py-1 rounded-full font-semibold text-gray-700">Level: <span id="level">1</span></span>
    </div>
   </div><!-- Game Board -->
   <div id="game-board" class="relative w-full max-w-lg aspect-square border-4 border-amber-800 rounded-lg overflow-hidden shadow-2xl" style="max-height: 500px;"><!-- Safe Zone (Top) -->
    <div class="safe-zone absolute top-0 left-0 right-0 h-[12%] flex items-center justify-center border-b-4 border-green-700"><span class="text-2xl">üè° Safe Zone üå∏</span>
    </div><!-- Road Lanes -->
    <div id="road-area" class="absolute top-[12%] left-0 right-0 bottom-[20%]"><!-- Lane 5 -->
     <div class="road-lane absolute w-full h-[20%] top-0">
      <div class="road-marking absolute w-full h-1 top-1/2 -translate-y-1/2 opacity-70"></div>
     </div><!-- Lane 4 -->
     <div class="road-lane absolute w-full h-[20%] top-[20%]">
      <div class="road-marking absolute w-full h-1 top-1/2 -translate-y-1/2 opacity-70"></div>
     </div><!-- Lane 3 -->
     <div class="road-lane absolute w-full h-[20%] top-[40%]">
      <div class="road-marking absolute w-full h-1 top-1/2 -translate-y-1/2 opacity-70"></div>
     </div><!-- Lane 2 -->
     <div class="road-lane absolute w-full h-[20%] top-[60%]">
      <div class="road-marking absolute w-full h-1 top-1/2 -translate-y-1/2 opacity-70"></div>
     </div><!-- Lane 1 -->
     <div class="road-lane absolute w-full h-[20%] top-[80%]">
      <div class="road-marking absolute w-full h-1 top-1/2 -translate-y-1/2 opacity-70"></div>
     </div>
    </div><!-- Start Zone (Bottom) -->
    <div class="start-zone absolute bottom-0 left-0 right-0 h-[20%] flex items-center justify-center border-t-4 border-amber-600"><span class="text-2xl">üåæ Start Here üåæ</span>
    </div><!-- Frying Pans Container -->
    <div id="pans-container" class="absolute top-[12%] left-0 right-0 bottom-[20%] pointer-events-none"></div><!-- Pig Player -->
    <div id="pig" class="pig absolute text-4xl z-10 cursor-pointer" style="left: 50%; bottom: 6%; transform: translateX(-50%);">
     üê∑
    </div><!-- Game Over Overlay -->
    <div id="game-overlay" class="absolute inset-0 bg-black/70 flex flex-col items-center justify-center z-20 hidden">
     <div class="bg-white rounded-2xl p-8 text-center shadow-2xl max-w-xs mx-4">
      <div id="overlay-emoji" class="text-6xl mb-4">
       üê∑
      </div>
      <h2 id="overlay-title" class="text-2xl font-bold text-gray-800 mb-2">Game Over</h2>
      <p id="overlay-message" class="text-gray-600 mb-4">Better luck next time!</p>
      <p class="text-lg font-semibold text-pink-600 mb-4">Final Score: <span id="final-score">0</span></p><button id="restart-btn" class="control-btn text-white font-bold py-3 px-8 rounded-full text-lg"> Play Again </button>
     </div>
    </div>
   </div><!-- Mobile Controls -->
   <div class="mt-4 grid grid-cols-3 gap-2 w-48">
    <div></div><button id="btn-up" class="control-btn text-white font-bold py-3 px-4 rounded-xl text-2xl" aria-label="Move up">‚¨ÜÔ∏è</button>
    <div></div><button id="btn-left" class="control-btn text-white font-bold py-3 px-4 rounded-xl text-2xl" aria-label="Move left">‚¨ÖÔ∏è</button> <button id="btn-down" class="control-btn text-white font-bold py-3 px-4 rounded-xl text-2xl" aria-label="Move down">‚¨ÜÔ∏è</button> <button id="btn-right" class="control-btn text-white font-bold py-3 px-4 rounded-xl text-2xl" aria-label="Move right">‚û°Ô∏è</button>
   </div>
   <p class="mt-3 text-gray-700 text-sm text-center">Use arrow keys or buttons to move the pig!</p>
  </div>
  <script>
    // Default configuration
    const defaultConfig = {
      game_title: 'üê∑ Pig Crossing üç≥',
      win_message: 'Amazing! You made it safely!',
      lose_message: 'Oh no! The pig got fried!',
      primary_color: '#ec4899',
      secondary_color: '#f9e79f',
      text_color: '#374151',
      accent_color: '#e74c3c',
      background_color: '#87CEEB',
      font_family: 'Fredoka'
    };

    let config = { ...defaultConfig };

    // Game state
    let gameState = {
      pigX: 50,
      pigY: 91,
      score: 0,
      lives: 3,
      level: 1,
      pans: [],
      gameRunning: true,
      stepSize: 15.2
    };

    const LANE_COUNT = 5;
    const ROAD_TOP = 12;
    const ROAD_BOTTOM = 80;
    const LANE_HEIGHT = (ROAD_BOTTOM - ROAD_TOP) / LANE_COUNT;

    // Initialize frying pans for each lane
    function initPans() {
      const container = document.getElementById('pans-container');
      container.innerHTML = '';
      gameState.pans = [];

      for (let lane = 0; lane < LANE_COUNT; lane++) {
        const direction = lane % 2 === 0 ? 1 : -1;
        const speed = (1.5 + Math.random() * 1.5 + gameState.level * 0.3) * direction;
        const panCount = 2 + Math.floor(gameState.level / 2);

        for (let i = 0; i < panCount; i++) {
          const pan = {
            lane,
            x: (i * (100 / panCount) + Math.random() * 20) % 100,
            speed,
            element: document.createElement('div')
          };

          pan.element.className = 'frying-pan absolute text-3xl';
          pan.element.innerHTML = 'üç≥';
          pan.element.style.top = `${(lane * 20) + 5}%`;
          pan.element.style.left = `${pan.x}%`;
          container.appendChild(pan.element);
          gameState.pans.push(pan);
        }
      }
    }

    // Update pan positions
    function updatePans() {
      gameState.pans.forEach(pan => {
        pan.x += pan.speed * 0.5;
        if (pan.x > 105) pan.x = -10;
        if (pan.x < -10) pan.x = 105;
        pan.element.style.left = `${pan.x}%`;
      });
    }

    // Check collision
    function checkCollision() {
      const pigSize = 8;
      
      for (const pan of gameState.pans) {
        const panY = ROAD_TOP + (pan.lane * LANE_HEIGHT) + (LANE_HEIGHT / 2);
        const panSize = 8;
        
        if (
          Math.abs(gameState.pigX - pan.x) < (pigSize + panSize) / 2 &&
          Math.abs(gameState.pigY - panY - 6) < (pigSize + panSize) / 2
        ) {
          return true;
        }
      }
      return false;
    }

    // Handle pig hit
    function pigHit() {
      gameState.lives--;
      document.getElementById('lives').textContent = gameState.lives;
      
      const pig = document.getElementById('pig');
      pig.classList.add('shake');
      setTimeout(() => pig.classList.remove('shake'), 300);

      if (gameState.lives <= 0) {
        endGame(false);
      } else {
        resetPigPosition();
      }
    }

    // Check win condition
    function checkWin() {
      if (gameState.pigY <= ROAD_TOP) {
        gameState.score += 100 * gameState.level;
        gameState.level++;
        document.getElementById('score').textContent = gameState.score;
        document.getElementById('level').textContent = gameState.level;
        
        const pig = document.getElementById('pig');
        pig.classList.add('bounce');
        setTimeout(() => {
          pig.classList.remove('bounce');
          resetPigPosition();
          initPans();
        }, 500);
      }
    }

    // Reset pig position
    function resetPigPosition() {
      gameState.pigX = 50;
      gameState.pigY = 91;
      updatePigPosition();
    }

    // Update pig visual position
    function updatePigPosition() {
      const pig = document.getElementById('pig');
      pig.style.left = `${gameState.pigX}%`;
      pig.style.bottom = `${100 - gameState.pigY}%`;
      pig.style.transform = 'translateX(-50%)';
    }

    // Move pig
    function movePig(direction) {
      if (!gameState.gameRunning) return;

      const step = gameState.stepSize;
      
      switch (direction) {
        case 'up':
          gameState.pigY = Math.max(5, gameState.pigY - step);
          break;
        case 'down':
          gameState.pigY = Math.min(91, gameState.pigY + step);
          break;
        case 'left':
          gameState.pigX = Math.max(5, gameState.pigX - 10);
          break;
        case 'right':
          gameState.pigX = Math.min(95, gameState.pigX + 10);
          break;
      }
      
      updatePigPosition();
      checkWin();
    }

    // End game
    function endGame(won) {
      gameState.gameRunning = false;
      const overlay = document.getElementById('game-overlay');
      const title = document.getElementById('overlay-title');
      const message = document.getElementById('overlay-message');
      const emoji = document.getElementById('overlay-emoji');
      const finalScore = document.getElementById('final-score');

      if (won) {
        emoji.textContent = 'üéâ';
        title.textContent = 'You Win!';
        message.textContent = config.win_message || defaultConfig.win_message;
      } else {
        emoji.textContent = 'üç≥';
        title.textContent = 'Game Over';
        message.textContent = config.lose_message || defaultConfig.lose_message;
      }

      finalScore.textContent = gameState.score;
      overlay.classList.remove('hidden');
    }

    // Restart game
    function restartGame() {
      gameState = {
        pigX: 50,
        pigY: 91,
        score: 0,
        lives: 3,
        level: 1,
        pans: [],
        gameRunning: true,
        stepSize: 15.2
      };

      document.getElementById('score').textContent = '0';
      document.getElementById('lives').textContent = '3';
      document.getElementById('level').textContent = '1';
      document.getElementById('game-overlay').classList.add('hidden');
      
      resetPigPosition();
      initPans();
    }

    // Game loop
    function gameLoop() {
      if (gameState.gameRunning) {
        updatePans();
        if (checkCollision()) {
          pigHit();
        }
      }
      requestAnimationFrame(gameLoop);
    }

    // Apply config to UI
    function applyConfig() {
      document.getElementById('game-title').textContent = config.game_title || defaultConfig.game_title;
      
      const fontFamily = config.font_family || defaultConfig.font_family;
      document.getElementById('game-title').style.fontFamily = `${fontFamily}, Fredoka, sans-serif`;
    }

    // Keyboard controls
    document.addEventListener('keydown', (e) => {
      switch (e.key) {
        case 'ArrowUp':
          e.preventDefault();
          movePig('up');
          break;
        case 'ArrowDown':
          e.preventDefault();
          movePig('down');
          break;
        case 'ArrowLeft':
          e.preventDefault();
          movePig('left');
          break;
        case 'ArrowRight':
          e.preventDefault();
          movePig('right');
          break;
      }
    });

    // Button controls
    document.getElementById('btn-up').addEventListener('click', () => movePig('up'));
    document.getElementById('btn-down').addEventListener('click', () => movePig('down'));
    document.getElementById('btn-left').addEventListener('click', () => movePig('left'));
    document.getElementById('btn-right').addEventListener('click', () => movePig('right'));
    document.getElementById('restart-btn').addEventListener('click', restartGame);

    // Initialize Element SDK
    if (window.elementSdk) {
      window.elementSdk.init({
        defaultConfig,
        onConfigChange: async (newConfig) => {
          config = { ...defaultConfig, ...newConfig };
          applyConfig();
        },
        mapToCapabilities: (cfg) => ({
          recolorables: [
            {
              get: () => cfg.primary_color || defaultConfig.primary_color,
              set: (value) => {
                cfg.primary_color = value;
                window.elementSdk.setConfig({ primary_color: value });
              }
            },
            {
              get: () => cfg.accent_color || defaultConfig.accent_color,
              set: (value) => {
                cfg.accent_color = value;
                window.elementSdk.setConfig({ accent_color: value });
              }
            }
          ],
          borderables: [],
          fontEditable: {
            get: () => cfg.font_family || defaultConfig.font_family,
            set: (value) => {
              cfg.font_family = value;
              window.elementSdk.setConfig({ font_family: value });
            }
          },
          fontSizeable: undefined
        }),
        mapToEditPanelValues: (cfg) => new Map([
          ['game_title', cfg.game_title || defaultConfig.game_title],
          ['win_message', cfg.win_message || defaultConfig.win_message],
          ['lose_message', cfg.lose_message || defaultConfig.lose_message]
        ])
      });
    }

    // Start the game
    initPans();
    gameLoop();
    applyConfig();
  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9cd795a082d89175',t:'MTc3MTAxOTg3OC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
